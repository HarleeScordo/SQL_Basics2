## Create and Maintaining Tablespaces

CREATE TABLESPACE tb_space
DATAFILE 'tb_space.dbf'
SIZE 50M;

## Big and small
CREATE BIGFILE TABLESPACE big_tb_space
DATAFILE ‘bigspace.dbf’
SIZE 50M;

CREATE SMALLFILE TABLESPACE small_tb_space
DATAFILE ‘smallspace.dbf’
SIZE 30M;


## Oracle Managed 

ALTER SYSTEM
SET db_create_file_dest = ‘C:\omf’ SCOPE=BOTH;

## Extenet Management 

CREATE TABLESPACE appl_data
DATAFILE ‘appl.dbf’
SIZE 50M
EXTENT MANAGEMENT LOCAL
SEGMENT SPACE MANAGEMENT AUTO;

CREATE TABLESPACE APP_DATA
DATAFILE ‘appl_data01.dbf’ SIZE 20M,
   ‘appl_data02.dbf’ SIZE 20M,
   ‘appl_data03.dbf’ SIZE 20M
EXTENT MANAGEMENT LOCAL;

CREATE TABLESPACE hr_index
DATAFILE ‘hr_index01.dbf’ SIZE 20M
EXTENT MANAGEMENT LOCAL UNIFORM SIZE 10M;

CREATE TABLESPACE hr_index01
DATAFILE ‘hrindex01.dbf’ SIZE 20M
EXTENT MANAGEMENT LOCAL AUTOALLOCATE;


## Segement and space

CREATE TABLESPACE index01
DATAFILE ‘indexes01.dbf’ SIZE 20M
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
SEGMENT SPACE MANAGEMENT MANUAL;

CREATE TABLESPACE hrdemo
DATAFILE ‘demo.dbf’ SIZE 20M
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
SEGMENT SPACE MANAGEMENT AUTO;


## Alternate tablespace 

CREATE TABLESPACE update01
DATAFILE ‘update_01.dbf’
SIZE 50M
DEFAULT STORAGE (INITIAL 256k NEXT 256 MINEXTENTS 2 PCTINCREASE 0 MAXEXTENTS 4096)
BLOCKSIZE 16K
MINIMUM EXTENT 256k
LOGGING
ONLINE
FORCE LOGGING
FLASHBACK ON
EXTENT MANAGEMENT DICTIONARY
SEGMENT SPACE MANAGEMENT MANUAL;

CREATE TABLESPACE queues01
DATAFILE ‘que01.dbf’
SIZE 50M
DEFAULT COMPRESS
BLOCKSIZE 8K
LOGGING
ONLINE
FORCE LOGGING
FLASHBACK ON
EXTENT MANAGEMENT LOCAL
SEGMENT SPACE MANAGEMENT AUTO
/


## Temp Space

CREATE TEMPORARY TABLESPACE tb_temp
TEMPFILE ‘temp01.dbf’ SIZE 10M;

CREATE TEMPORARY TABLESPACE tbtemp
TEMPFILE ‘tempa.dbf’ SIZE 20M
EXTENT MANAGEMENT LOCAL UNIFORM SIZE 5M
TABLESPACE GROUP ALL_TEMPS;

## Undos

oradim -NEW -SID TEST -STARTMODE manual -PFILE "C:\app\DBAdmin\product\12.1.0\dbhome_1\database\initTEST.ora"

Services.msc

SET ORACLE_SID=TEST

Sqlplus /nolog

Connect / as sysdba

Startup;

alter system set db_create_online_log_dest_1='C:\app\DBAdmin\product\12.1.0\dbhome_1\database\df1';
alter system set db_create_online_log_dest_2='C:\app\DBAdmin\product\12.1.0\dbhome_1\database\df2';
alter system set db_create_file_dest='C:\app\DBAdmin\product\12.1.0\dbhome_1\database\df1';

CREATE DATABASE "TEST"
DATAFILE 'C:\app\DBAdmin\oradata\TEST\testline.dbf'
SIZE 100M REUSE AUTOEXTEND ON NEXT 10240K MAXSIZE UNLIMITED
EXTENT MANAGEMENT LOCAL
SYSAUX DATAFILE 'C:\app\DBAdmin\oradata\TEST\systest.dbf'
SIZE 120M REUSE AUTOEXTEND ON NEXT 10240K MAXSIZE UNLIMITED
SMALLFILE DEFAULT TEMPORARY TABLESPACE TEMP01
  TEMPFILE 'C:\app\DBAdmin\oradata\TEST\temptest.dbf'
  SIZE 20M AUTOEXTEND ON NEXT 640K MAXSIZE UNLIMITED
SMALLFILE UNDO TABLESPACE "UNDOTBS01"
  DATAFILE 'C:\app\DBAdmin\oradata\TEST\undotest.dbf'
  SIZE 200M REUSE AUTOEXTEND ON NEXT 5120K MAXSIZE UNLIMITED
DEFAULT TABLESPACE "USERS01"
  DATAFILE 'C:\app\DBAdmin\oradata\TEST\usertest.dbf'
  SIZE 5M REUSE AUTOEXTEND ON NEXT 1280K MAXSIZE UNLIMITED
  EXTENT MANAGEMENT LOCAL SEGMENT SPACE MANAGEMENT AUTO
CHARACTER SET WE8MSWIN1252
LOGFILE
GROUP 1 ('C:\app\DBAdmin\oradata\TEST\redo01.dbf') SIZE 51200K,
GROUP 2 ('C:\app\DBAdmin\oradata\TEST\redo02.dbf') SIZE 51200K,
GROUP 3 ('C:\app\DBAdmin\oradata\TEST\redo03.dbf') SIZE 51200K
SET DEFAULT SMALLFILE TABLESPACE
USER SYS IDENTIFIED BY welcome123
USER SYSTEM IDENTIFIED BY welcome23
/

CREATE UNDO TABLESPACE undo
DATAFILE ‘UNDO01.dbf’ SIZE 20M;


## Removing 

DROP TABLESPACE tbtemp;

DROP TABLESPACE tb_temp INCLUDING CONTENTS;

DROP TABLESPACE undo INCLUDING CONTENTS CASCADE CONSTRAINTS;

DROP TABLESPACE hrdemo INCLUDING CONTENTS AND DATAFILES;


## Modify 

ALTER TABLESPACE appl_data
DEFAULT STORAGE (INITIAL 2M NEXT 2M);

ALTER TABLESPACE appl_data
ADD DATAFILE ‘appl01.dbf’ SIZE 20M;

ALTER TABLESPACE index01 ONLINE;

ALTER TABLESPACE index01 OFFLINE TEMPORARY;

ALTER TABLESPACE index01 OFFLINE IMMEDIATE;

ALTER TABLESPACE index01 OFFLINE FOR RECOVER;

ALTER TABLESPACE index01 ONLINE;

ALTER TABLESPACE index01 OFFLINE;

ALTER TABLESPACE index01 ONLINE;

ALTER TABLESPACE index01 READ ONLY;

ALTER TABLESPACE index01 READ WRITE;

Shutdown immediate;
Startup mount;
Alter database archivelog;
Alter database open;

ALTER TABLESPACE hr_index BEGIN BACKUP;

ALTER TABLESPACE hr_index END BACKUP;



## Getting Info

SELECT tablespace_name, status, contents,
extent_management extents,
segment_space_management free_space
FROM dba_tablespaces;

SELECT name, bigfile, flashback_on
FROM v$tablespace;

SELECT tablespace_name, file_name, bytes/1024 kbytes
FROM dba_data_files
UNION ALL
SELECT tablespace_name, file_name, bytes/1024 kbytes
FROM dba_temp_files;



## Ops on Data Files

CREATE TABLESPACE appldata
DATAFILE ‘appldata01.dbf’
SIZE 500M
AUTOEXTEND ON NEXT 100M MAXSIZE 600M;

ALTER DATABASE
DATAFILE ‘hr_index01.dbf’
AUTOEXTEND OFF;

ALTER DATABASE
DATAFILE ‘hr_index01.dbf’
AUTOEXTEND ON NEXT 100M MAXSIZE 200M;

ALTER DATABASE
DATAFILE ‘hr_index01.dbf’
RESIZE 500M;

ALTER DATABASE DATAFILE ‘hr_index01.dbf’ OFFLINE;

ALTER DATABASE
DATAFILE ‘hrindex01.dbf’ ONLINE;

ALTER DATABASE MOVE DATAFILE
‘hrindex01.dbf’ TO ‘hrdemo.dbf’;

ALTER DATABASE
MOVE DATAFILE ‘indexes01.dbf’ TO ‘indemo.dbf’ KEEP;

ALTER DATABASE MOVE DATAFILE
‘appldata01.dbf’ TO ‘appdemo.dbf’ REUSE;

ALTER TABLESPACE hr_index01 OFFLINE;

ALTER DATABASE RENAME FILE ‘hrdemo.dbf’ TO ‘userdemo.dbf’;

ALTER TABLESPACE hr_index01 ONLINE;



## Managed files features 

db_name=demo

oradim -NEW -SID demo -STARTMODE manual -PFILE "C:\app\DBAdmin\product\12.1.0\dbhome_1\database\initdemo.ora"

Services.msc

SET ORACLE_SID=demo

Sqlplus /nolog

Connect / as sysdba

Startup;

alter system set db_create_online_log_dest_1='C:\app\DBAdmin\product\12.1.0\dbhome_1\database\df1';
alter system set db_create_online_log_dest_2='C:\app\DBAdmin\product\12.1.0\dbhome_1\database\df2';
alter system set db_create_file_dest='C:\app\DBAdmin\product\12.1.0\dbhome_1\database\df1';

CREATE DATABASE demo
DEFAULT TEMPORARY TABLESPACE temp;

ALTER SESSION SET DB_CREATE_FILE_DEST = ‘C:\omf’;
CREATE TABLESPACE USERDATA;
ALTER SESSION SET DB_CREATE_FILE_DEST = ‘C:\omfdata’;
CREATE TABLESPACE USER_DATA;

CREATE TABLESPACE PAY_DATA DATAFILE SIZE 10M
AUTOEXTEND OFF;

CREATE TABLESPACE PAY_INDEX
DATAFILE SIZE 20M AUTOEXTEND OFF,
SIZE 30M AUTOEXTEND ON MAXSIZE 1000M,
SIZE 1M;

ALTER SYSTEM SET DB_CREATE_FILE_DEST = ‘C:\omf’;
ALTER TABLESPACE USERDATA ADD DATAFILE;
ALTER SYSTEM SET DB_CREATE_FILE_DEST = ‘C:\omfdata’;
ALTER TABLESPACE USER_DATA
ADD DATAFILE SIZE 20M AUTOEXTEND OFF;



## Queries 

SELECT FILE#, RFILE#, STATUS, BYTES, BLOCK_SIZE
FROM V$DATAFILE;

SELECT FILE#, RFILE#, STATUS, BYTES, BLOCK_SIZE
FROM V$TEMPFILE;

SELECT TABLESPACE_NAME, FILE_NAME, BYTES, AUTOEXTENSIBLE
FROM DBA_DATA_FILES;

SELECT TABLESPACE_NAME, FILE_NAME, BYTES, AUTOEXTENSIBLE
FROM DBA_TEMP_FILES;

ALTER DATABASE DATAFILE
‘indemo.dbf’ RESIZE 200M;

ALTER DATABASE DATAFILE
‘indemo.dbf’
AUTOEXTEND ON NEXT 50M MAXSIZE 100M;





